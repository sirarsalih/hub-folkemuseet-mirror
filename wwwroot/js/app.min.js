(function(){"use strict";var n={isLoading:!0,visibleCards:{},selectedCities:[],spinner:document.querySelector(".loader"),cardTemplate:document.querySelector(".cardTemplate"),container:document.querySelector(".main"),addDialog:document.querySelector(".dialog-container"),daysOfWeek:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},t;document.getElementById("butAddCity").addEventListener("click",function(){var t=document.getElementById("selectCityToAdd"),i=t.options[t.selectedIndex],r=i.value,u=i.textContent;n.selectedCities||(n.selectedCities=[]);n.getForecast(r,u);n.selectedCities.push({key:r,label:u});n.saveSelectedCities();n.toggleAddDialog(!1)});document.getElementById("butAddCancel").addEventListener("click",function(){n.toggleAddDialog(!1)});n.toggleAddDialog=function(t){t?n.addDialog.classList.add("dialog-container--visible"):n.addDialog.classList.remove("dialog-container--visible")};n.updateForecastCard=function(t){var a=new Date(t.created),v=t.channel.astronomy.sunrise,y=t.channel.astronomy.sunset,o=t.channel.item.condition,p=t.channel.atmosphere.humidity,c=t.channel.wind,i=n.visibleCards[t.key],h,f,l,s,r,u,e;if(i||(i=n.cardTemplate.cloneNode(!0),i.classList.remove("cardTemplate"),i.querySelector(".location").textContent=t.label,i.removeAttribute("hidden"),n.container.appendChild(i),n.visibleCards[t.key]=i),h=i.querySelector(".card-last-updated"),f=h.textContent,!f||(f=new Date(f),!(a.getTime()<f.getTime()))){for(h.textContent=t.created,i.querySelector(".description").textContent=o.text,i.querySelector(".date").textContent=o.date,i.querySelector(".current .icon").classList.add(n.getIconClass(o.code)),i.querySelector(".current .temperature .value").textContent=Math.round(o.temp),i.querySelector(".current .sunrise").textContent=v,i.querySelector(".current .sunset").textContent=y,i.querySelector(".current .humidity").textContent=Math.round(p)+"%",i.querySelector(".current .wind .value").textContent=Math.round(c.speed),i.querySelector(".current .wind .direction").textContent=c.direction,l=i.querySelectorAll(".future .oneday"),s=new Date,s=s.getDay(),r=0;r<7;r++)u=l[r],e=t.channel.item.forecast[r],e&&u&&(u.querySelector(".date").textContent=n.daysOfWeek[(r+s)%7],u.querySelector(".icon").classList.add(n.getIconClass(e.code)),u.querySelector(".temp-high .value").textContent=Math.round(e.high),u.querySelector(".temp-low .value").textContent=Math.round(e.low));n.isLoading&&(n.spinner.setAttribute("hidden",!0),n.container.removeAttribute("hidden"),n.isLoading=!1)}};n.getForecast=function(i,r){var e="select * from weather.forecast where woeid="+i,f="https://query.yahooapis.com/v1/public/yql?format=json&q="+e,u;"caches"in window&&caches.match(f).then(function(t){t&&t.json().then(function(t){var u=t.query.results;u.key=i;u.label=r;u.created=t.query.created;n.updateForecastCard(u)})});u=new XMLHttpRequest;u.onreadystatechange=function(){if(u.readyState===XMLHttpRequest.DONE){if(u.status===200){var e=JSON.parse(u.response),f=e.query.results;f.key=i;f.label=r;f.created=e.query.created;n.updateForecastCard(f)}}else n.updateForecastCard(t)};u.open("GET",f);u.send()};n.updateForecasts=function(){var t=Object.keys(n.visibleCards);t.forEach(function(t){n.getForecast(t)})};n.saveSelectedCities=function(){var t=JSON.stringify(n.selectedCities);localStorage.selectedCities=t};n.getIconClass=function(n){n=parseInt(n);switch(n){case 25:case 32:case 33:case 34:case 36:case 3200:return"clear-day";case 0:case 1:case 2:case 6:case 8:case 9:case 10:case 11:case 12:case 17:case 35:case 40:return"rain";case 3:case 4:case 37:case 38:case 39:case 45:case 47:return"thunderstorms";case 5:case 7:case 13:case 14:case 16:case 18:case 41:case 42:case 43:case 46:return"snow";case 15:case 19:case 20:case 21:case 22:return"fog";case 24:case 23:return"windy";case 26:case 27:case 28:case 31:return"cloudy";case 29:case 30:case 44:return"partly-cloudy-day"}};t={key:"2459115",label:"New York, NY",created:"2016-07-22T01:00:00Z",channel:{astronomy:{sunrise:"5:43 am",sunset:"8:21 pm"},item:{condition:{text:"Windy",date:"Thu, 21 Jul 2016 09:00 PM EDT",temp:56,code:24},forecast:[{code:44,high:86,low:70},{code:44,high:94,low:73},{code:4,high:95,low:78},{code:24,high:75,low:89},{code:24,high:89,low:77},{code:44,high:92,low:79},{code:44,high:89,low:77}]},atmosphere:{humidity:56},wind:{speed:25,direction:195}}};n.selectedCities=localStorage.selectedCities;n.selectedCities?(n.selectedCities=JSON.parse(n.selectedCities),n.selectedCities.forEach(function(t){n.getForecast(t.key,t.label)})):(n.updateForecastCard(t),n.selectedCities=[{key:t.key,label:t.label}],n.saveSelectedCities());"serviceWorker"in navigator&&navigator.serviceWorker.register("./service-worker.js").then(function(){console.log("Service Worker Registered")})})();